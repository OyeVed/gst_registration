<!DOCTYPE html>
<html lang="en">

<head>
    <title>Gst Form - GST</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Main CSS-->
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <!-- Font-icon css-->
    <link rel="stylesheet" type="text/css"
        href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body class="app sidebar-mini">
    <!-- NOTE: START: -->
    <!-- loader -->
    <div class="overlay"></div>
    <div class="spanner">
        <div class="loader"></div>
    </div>
    <!-- END: -->
    <!-- Navbar-->
    <header class="app-header"><a class="app-header__logo" href="index.html">GST</a>
        <!-- Sidebar toggle button--><a class="app-sidebar__toggle" href="#" data-toggle="sidebar"
            aria-label="Hide Sidebar"></a>
        <!-- Navbar Right Menu-->
        <ul class="app-nav">
            <!-- User Menu-->
            <li class="dropdown"><a class="app-nav__item" href="#" data-toggle="dropdown"
                    aria-label="Open Profile Menu"><i class="fa fa-user fa-lg"></i></a>
                <ul class="dropdown-menu settings-menu dropdown-menu-right">
                    <li><a class="dropdown-item" href="page-user.html"><i class="fa fa-cog fa-lg"></i> Settings</a></li>
                    <li><a class="dropdown-item" href="page-user.html"><i class="fa fa-user fa-lg"></i> Profile</a></li>
                    <li><a class="dropdown-item" href="page-login.html"><i class="fa fa-sign-out fa-lg"></i> Logout</a>
                    </li>
                </ul>
            </li>
        </ul>
    </header>
    <!-- Sidebar menu-->
    <div class="app-sidebar__overlay" data-toggle="sidebar"></div>
    <aside class="app-sidebar">
        <div class="app-sidebar__user">
            <img class="app-sidebar__user-avatar"
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAM1BMVEXk5ueutLfn6eqrsbTp6+zg4uOwtrnJzc/j5earsbW0uby4vcDQ09XGyszU19jd3+G/xMamCvwDAAAFLklEQVR4nO2d2bLbIAxAbYE3sDH//7WFbPfexG4MiCAcnWmnrzkjIRaD2jQMwzAMwzAMwzAMwzAMwzAMwzAMwzAMwzAMwzAMw5wQkHJczewxZh2lhNK/CBOQo1n0JIT74/H/qMV0Z7GU3aCcVPuEE1XDCtVLAhgtpme7H0s1N1U7QjO0L8F7llzGeh1hEG/8Lo7TUmmuSrOfns9xnGXpXxsONPpA/B6OqqstjC6Ax/0ujkNdYQQbKNi2k64qiiEZ+ohi35X+2YcZw/WujmslYewiAliVYrxgJYrdwUmwXsU+RdApUi83oNIE27YvrfB/ZPg8+BJETXnqh9CVzBbTQHgojgiCvtqU9thFJg/CKz3VIMKMEkIXxIWqIpIg2SkjYj+xC816mrJae2aiWGykxRNsW0UwiJghJDljYI5CD8GRiCtIsJxizYUPQ2pzItZy5pcisTRdk/a9m4amtNNfBuQkdVhSaYqfpNTSFGfb9GRIakrE2Pm+GFLaCQPqiu0OpWP+HMPQQcgQMiQprWXNmsVwIjQjYi/ZrhAqNTCgr2gu0Jnz85RSSjso0HkMFZ0YZjKkc26a/jlmh9JiDyDxi9oeorTYAzZkwwoMz19pzj9bnH/GP/+qbchjSGflneWYhtTuKdMOmNKZcJ5TjInQKcYXnESd/jQxy0ENpULTNGOGgxpap/oyw9pbUAqhfx2Dbkhovvfgz4iUzoM9+GlK6/Mh4q29hyC1mwro30hpVVLPF9wYQr71RazOeM5/cw81iBRD+A03aM9/C/obbrKjbYSpCmIVG3qT/Q8oeUo3Rz0IL7vI1tEbCB9pSiu8I/aV8x3Kg/BGWrWp4ZVs0nZfmAoEG4h/61yHYIJiFSl6Q0Vk6tTW1N8kYp8hdOkfHYYMXd2Qft+8CYwqYDSKvqIh+MCF8Wgca2u/cwdgeW3TtuVn6+1oBs3yLo5C2JpK6CvQzGpfUkz9UG/87gCsi5o2LIXolxN0FbwAsjOLEr+YJmXn7iR6N0BCt5p5cMxm7eAsfS+/CACQf4CTpKjzgkvr2cVarVTf96372yut7XLJ1sa7lv6VcfgYrWaxqr3Wlo1S6pvStr22sxOtTNPLzdY3nj20bPP+ejFdJYkLsjGLdtPBEbe/mr2bQKiXWJDroA+vtzc0p9aahuwqHMDYrQEXHEw9jwQl3drMpts9JBU1SdktPe5FBRdJQ6bwXBpa57ib2A8kukQDzMjh++Uo7Fo6Wd02Pkf4fknqoo4HtvAIjsqUcjx6DIPgWCaOML9rKI/oqD9/lgNrn+eF+p7j8tnzHBiR7+kdUGw/+V1Kzkc75mMy6U+FMaxjPibiM1U1uGM+puInHpmALZCgP4pt7i840MV8+0R1zPsRB6UTcqpizncYwZ89syDydfyWCwXB1l8/zRNGWbTG/GHKUm9AkxHMc/EGSk3z2+ArEhPEV5TUBLEvUGFcjEUH80J/jveTGOAJEljJbILWGQT3zRYiwuKsUXN1EEJAzBhRJFll7mBUG7KD8EqPkKekBREaL8hMDZLQSG6AQjtHPYmvTQnX0TtpC1SYCe2YdkkyLP3jj5BSbKiuR585eQhTgoje6yIb0Yb0C+mV6EYvebqw5SDy2WmubogZiF2AVxPC2FpDf8H2Q9QWo6IkjUxTWVEI3WY/wrCeSuqJ+eRWzXR/JXwgVjUMozbCOfoEZiSiKVGepqv5CJ8RyR4D7xBeamqa7z3BJ/z17JxuBPdv93d/a2Ki878MMAzDMAzDMAzDMAzDMF/KP09VUmxBAiI3AAAAAElFTkSuQmCC"
                alt="User Image">
            <p class="app-sidebar__user-name">John Doe</p>
            <p class="app-sidebar__user-designation">Admin</p>
        </div>
        <ul class="app-menu">
            <li><a class="app-menu__item" href="dashboard.html"><i class="app-menu__icon fa fa-dashboard"></i><span
                        class="app-menu__label">Dashboard</span></a>
            </li>
            <li><a class="app-menu__item" href="payments.html"><i class="app-menu__icon fa fa-dashboard"></i><span
                        class="app-menu__label">Payments</span></a>
            </li>
        </ul>
    </aside>
    <main class="app-content">
        <div class="app-title">
            <div>
                <h1><i class="fa fa-file-text" aria-hidden="true"></i> GST Form</h1>
            </div>
        </div>
        <div class="tile p-5">
            <h3 class="tile-title">Your Form</h3>
            <div class="tile-body">
                <form id="gst_form">

                </form>
            </div>
            <div class="tile-footer">
                <button onclick="submitForm()" class="btn btn-primary" type="button"><i
                        class="fa fa-fw fa-lg fa-check-circle"></i>Register</button>&nbsp;&nbsp;&nbsp;<a
                    class="btn btn-secondary" href="#"><i class="fa fa-fw fa-lg fa-times-circle"></i>Cancel</a>
            </div>
        </div>
    </main>
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/plugins/pace.min.js"></script>
    <script type="text/javascript" src="js/plugins/chart.js"></script>
    <script src="js/globalFunction.js"></script>
    <script type="text/javascript" src="js/plugins/bootstrap-notify.min.js"></script>
    <script type="text/javascript">
        let fetchedFields = [
            {
                "field_id": "1",
                "field_title": "Trade Name",
                "field_type": "Text",
                "field_required": false,
                "field_associated_to": null
            },
            {
                "field_id": "6",
                "field_title": "Constitution of Business",
                "field_type": "Dropdown",
                "field_required": true,
                "field_associated_to": null,
                "field_values": [["Foreign Company"], ["Foreign Limited Liability Partnership"], ["Government Department"], ["Hindu Undivided Family"], ["Limited Liability Partnership"], ["Local Authority"], ["Others", "20"]]
            },
            {
                "field_id": "2",
                "field_title": "District",
                "field_type": "Dropdown",
                "field_required": true,
                "field_associated_to": null,
                "field_values": [["Ahmednagar"], ["Akola"], ["Amravati"], ["Aurangabad"], ["Beed"], ["Bhandara"], ["Buldhana"], ["Chandrapur"], ["Dhule"], ["Gadchiroli"], ["Gondia"], ["Hingoli"]]
            },
            {
                "field_id": "3",
                "field_title": "Are you applying for registration as a casual taxable person?",
                "field_type": "Toggle",
                "field_required": false,
                "field_associated_to": null,
                "field_values": [["No"], ["Yes", "21", "22", "23"]]
            },
            {
                "field_id": "4",
                "field_title": "Reason to obtain registration",
                "field_type": "Dropdown",
                "field_required": true,
                "field_associated_to": null,
                "field_values": [["Crossing the Threshold"], ["Inter-State supply"], ["Liability to pay as recipient of goods or services"], ["Transfer / Succession of business"], ["Death of the Proprietor"], ["De-merger"], ["Change in constitution of business"], ["Merger /Amalgamation"]]
            },
            {
                "field_id": "5",
                "field_title": "Date of commencement of Business",
                "field_type": "Text",
                "field_required": true,
                "field_associated_to": null
            },
            {
                "field_id": "6",
                "field_title": "Date on which liability to register arises",
                "field_type": "Text",
                "field_required": true,
                "field_associated_to": null
            }
        ]
        let fieldsAssociate = [];
        function setFields(container_id_n, nowFields) {
            let container_id = document.getElementById(container_id_n)
            container_id.innerHTML = ''
            for (let i = 0; i < nowFields.length; i++) {
                const element = nowFields[i];
                switch (element?.field_type) {
                    case 'Text':
                        container_id.innerHTML = container_id.innerHTML +
                            `
                            <div class="form-group" >
                            <label class="control-label">${element?.field_title}</label>${element?.field_required ? '<span class="text-danger" style="font-size:23px;" >*</span>' : ''}
                            <input class="form-control" id='${element?.field_type}_${element?.field_id}${element?.field_parent_id || ''}' type="text" placeholder='${element?.field_title?.toLocaleLowerCase()}'>
                            </div>
                            `
                        break;
                    case 'Radio-Button':
                        container_id.innerHTML = container_id.innerHTML +
                            `<div class="form-group" >
                             <label class="control-label">${element?.field_title}</label>${element?.field_required ? '<span class="text-danger" style="font-size:23px;" >*</span>' : ''}
                             ${element?.field_values?.map((fieldValue, index) => (
                                `<div class="form-check">
                                <label class="form-check-label">
                                   <input class="form-check-input" type="radio"  id='${element?.field_type}_${element?.field_id}${element?.field_parent_id || ''}_${index}' name='${element?.field_type}_${element?.field_id}${element?.field_parent_id || ''}'>${fieldValue[0]}
                                </label>
                            </div>`
                            )).join('')}
                        </div>
                        `
                        break;
                    case 'Toggle':
                        container_id.innerHTML = container_id.innerHTML +
                            `
                    <div class="form-group" >
                    <label class="control-label">${element?.field_title}</label>${element?.field_required ? '<span class="text-danger" style="font-size:23px;" >*</span>' : ''}
                        <div class="d-flex justify-content-between align-items-center" style="max-width:100px;">
                            <p> ${element?.field_values[0][0]}</p>
                         <div class="toggle lg ">
                        <label>
                          <input type="checkbox" onchange="updateFieldValueAssociateDropDown(${element?.field_id}${element?.field_parent_id || ''},'Toggle','${element?.field_values[1]}')"  id='${element?.field_type}_${element?.field_id}${element?.field_parent_id || ''}'><span class="button-indecator" ></span>
                        </label>   
                       </div>
                       <p> ${element?.field_values[1][0]}</p>
                            </div>
                    </div>
                    <div id="field_value_associate_${element?.field_id}${element?.field_parent_id || ''}" ></div>
                    `
                        break;
                    case 'Dropdown':
                        container_id.innerHTML = container_id.innerHTML +
                            `
                        <div class="form-group">
                             <label for='${element?.field_type}_${element?.field_id}${element?.field_parent_id || ''}'>${element?.field_title}</label>${element?.field_required ? '<span class="text-danger" style="font-size:23px;" >*</span>' : ''}
                            <select onchange="updateFieldValueAssociateDropDown(${element?.field_id}${element?.field_parent_id || ''},'Dropdown','dropdown')" class="form-control" id='${element?.field_type}_${element?.field_id}${element?.field_parent_id || ''}'>
                                <option value="" >-Select One - </option>
                                ${element?.field_values?.map(fieldValue => (
                                `<option value='${fieldValue}'>${fieldValue[0]}</option>`
                            )).join('')}
                            </select>
                        </div>
                        <div id="field_value_associate_${element?.field_id}${element?.field_parent_id || ''}" ></div>
                        `
                    default:
                        break;
                }
            }
        }
        setFields('gst_form', fetchedFields)
        function updateFieldValueAssociateDropDown(id, field_id_type, get_fieldValue) {
            console.log(get_fieldValue)
            let arrOfData = null
            let arrOfNum = []
            switch (field_id_type) {
                case 'Toggle':
                    let selectedToggle = document.getElementById(`${field_id_type}_${id}`)
                    if (selectedToggle.checked) {
                        arrOfData = get_fieldValue.split(',')
                    }
                    break;
                case 'Dropdown':
                    let selectDropDown = document.getElementById(`${field_id_type}_${id}`);
                    arrOfData = selectDropDown.value.split(',');
                    break;
                default:
                    break;
            }
            if (arrOfData?.length > 1) {
                let theRemovedElement = arrOfData.shift();
                arrOfNum = arrOfData.map(str => {
                    return Number(str);
                });
            }
            console.log(arrOfNum)
            if (arrOfNum?.length > 0) {
                startLoader()
                axiosInstance.post('fetch_dependencies', {
                    "fetch_field": arrOfNum
                }).then((response) => {
                    console.log(response)
                    let newGG = []
                    if (id == 6) {
                        newGG = [
                            {
                                "field_id": "20",
                                "field_title": "Others (Please specify)",
                                "field_type": "Text",
                                "field_required": true,
                                "field_associated_to": null
                            }
                        ]
                    }
                    if (id == 3) {
                        newGG = [
                            {
                                "field_id": "21",
                                "field_title": "Period for which registration is required",
                                "field_type": "Text",
                                "field_required": true,
                                "field_associated_to": null
                            },
                            {
                                "field_id": "22",
                                "field_title": "Integrated Tax Turnover",
                                "field_type": "Text",
                                "field_required": true,
                                "field_associated_to": null
                            },
                            {
                                "field_id": "23",
                                "field_title": "Integrated Tax Net Liability",
                                "field_type": "Text",
                                "field_required": true,
                                "field_associated_to": null
                            }
                        ]
                    }
                    let currentFieldAssociate = fieldsAssociate?.filter(fa => fa?.field_parent_id != id)
                    fieldsAssociate = [...currentFieldAssociate, ...newGG]
                    setFields(`field_value_associate_${id}`, newGG);
                    console.log(fieldsAssociate)
                    endLoader()
                }, (error) => {
                    console.log('error', error);
                    endLoader()
                })
            } else {
                let currentFieldAssociate = fieldsAssociate?.filter(fa => fa?.field_parent_id != id)
                fieldsAssociate = [...currentFieldAssociate]
                document.getElementById(`field_value_associate_${id}`).innerHTML = ''
            }
        }

        function validateAllFields(validateFieldList) {
            for (let i = 0; i < validateFieldList.length; i++) {
                const element = validateFieldList[i];
                if (element?.field_required) {
                    switch (element?.field_type) {
                        case 'Text':
                            console.log(element)
                            let nowValue = document.getElementById(`${element?.field_type}_${element?.field_id}${element?.field_parent_id || ''}`).value
                            if (nowValue == "" || nowValue == null || nowValue == undefined) {
                                $.notify({
                                    title: "",
                                    message: `Please enter ${element?.field_title.toLocaleLowerCase()}`,
                                    icon: 'fa fa-times'
                                }, {
                                    type: "danger",
                                });
                                return false;
                            }
                            break;
                        case 'Radio-Button':
                            let radioButtons = document.querySelectorAll(`input[name='${element?.field_type}_${element?.field_id}${element?.field_parent_id || ''}']`);
                            let selectedSize = null
                            for (let radioButton of radioButtons) {
                                if (radioButton.checked) {
                                    selectedSize = radioButton.value;
                                    break;
                                }
                            }
                            if (selectedSize == null) {
                                $.notify({
                                    title: "",
                                    message: `Please select ${element?.field_title.toLocaleLowerCase()}`,
                                    icon: 'fa fa-times'
                                }, {
                                    type: "danger",
                                });
                                return false;
                            }
                            break;
                        case 'Dropdown':
                            let nowDropDown = document.getElementById(`${element?.field_type}_${element?.field_id}${element?.field_parent_id || ''}`).value
                            if (nowDropDown == "") {
                                $.notify({
                                    title: "",
                                    message: `Please select ${element?.field_title.toLocaleLowerCase()}`,
                                    icon: 'fa fa-times'
                                }, {
                                    type: "danger",
                                });
                                return false;
                            }
                            break;
                        default:
                            break;
                    }
                }
            }
            return true
        }
        function submitForm() {
            let validateFirst = validateAllFields(fetchedFields)
            if (!validateFirst) {
                return
            }
            let validateSecond = validateAllFields(fieldsAssociate)
            if (!validateSecond) {
                return
            }
            $('#gst_form')[0].reset();
            $.notify({
                title: "",
                message: `Form submitted successfully`,
                icon: 'fa fa-times'
            }, {
                type: "success",
            });
        }
    </script>
</body>

</html>